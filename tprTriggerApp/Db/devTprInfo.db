#
# This db file can be loaded into an IOC with or w/o an TPR
# We recommend adding this to each IOC that supports TPRs so
# scripts are able to derive the TPR and trigger info from
# each device's PV prefix.
#
# Required macros:
#	DEV				Device PV prefix
#	TPR_USED		0 = Unused, 1 = Used
#
# Optional macros:
#	TPR				TPR PV prefix, defaults to $(DEV):NoTpr
#	TRIG_CH			TPR Trigger channel number, defaults to 0
#
# It adds 2 new PVs for each device
#	$(DEV):TPR_PV		PV prefix for this device's TPR
#	$(DEV):TPR_TRIG_CH	TPR Trigger channel number for this device
#
# It also adds a new record, TprUsed with required macro
#	$(TPR):TprUsed		bo record: 0 = Unused, 1 = Used
#
# The other records provide a minimal subset of records that
# are compatible w/ their equivalent tprTrigger module records
# to allow edm screens to work properly with or without an TPR
#	$(TPR):VERERR
#	$(TPR):RXLNKSTATUS
#
# Usage for devices with an TPR:
#	Just add this line to your st.cmd file with appropriate definitions for DEV_PV, TPR_PV, and TRIG_CH
#	You can load it before or after your evr db files, and can load one instance per device.
# dbLoadRecords( "db/devTprInfo.db", "DEV=$DEV_PV,TPR=$TPR,TRIG_CH=$TRIG_CH,TPR_USED=1 )
#
# If your IOC supports some devices with TPRs and some without, follow the above usage
# for devices with TPRs.   For devices without TPRs you can just load this. 
# dbLoadRecords( "db/devTprInfo.db", "DEV=$DEV_PV,TPR_USED=0 )
#
# This allows your edm screens to use group visibility to hide or show our traditional
# green diamond $(TPR):STATUS widget without getting white unconnected widget outlines
# for the hidden $(TPR):STATUS widget for device screens w/ no TPR
# Your edm screen should define the TPR macro as $(DEV):NoTpr or you can use your desired TPR_PV value.
#

record( stringout, "$(DEV):TPR_PV" )
{
	field( PINI, "YES" )
	field( VAL, "$(TPR=$(DEV):NoTpr)" )
}

record( longout, "$(DEV):TPR_TRIG_CH" )
{
	field( PINI, "YES" )
	field( VAL, "$(TRIG_CH=0)" )
}

record( bo, "$(TPR=$(DEV):NoTpr):TprUsed" )
{
	field( PINI, "YES" )
	field( ZNAM, "Unused" )
	field( ONAM, "Used" )
	field( DOL,  "$(TPR_USED)" )
}

# Must match VERERR from tprTrigger module pcieSlave_tprTrig.db
record(mbbi, "$(TPR):VERERR")
{
#  field(PINI, "YES")
#  field(DOL, "1")
  field(ZRVL, "0")
  field(ZRST, "No Error")
  field(ONVL, "1")
  field(ONST, "Error")
  field(ONSV, "MAJOR")
}

# Must match RXLNKSTATUS from tprTrigger module pcieSlave_tprTrig.db
record(mbbi, "$(TPR):RXLNKSTATUS")
{
  field(PINI, "YES")
#  field(DOL, "0")
  field(ZRVL, "0")
  field(ZRST, "Link Down")
  field(ZRSV, "MAJOR")
  field(ONVL, "1")
  field(ONST, "Link Up")
}

